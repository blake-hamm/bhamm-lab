name: Run ansible playbook
on:
  push:
  # paths:
  #   - 'ansible/**'
  pull_request:
  # paths:
  #   - 'ansible/**'
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: cachix/install-nix-action@v27
        with:
          nix_path: nixpkgs=channel:nixos-unstable
      - name: Use shell.nix and Run Ansible Playbook
        env:
          VAULT_ROLE_ID: ${{ secrets.VAULT_ROLE_ID }}
          VAULT_SECRET_ID: ${{ secrets.VAULT_SECRET_ID }}
        run: |
          nix-shell shell.nix --run "ansible-playbook -i inventories/hosts playbook.yml"
