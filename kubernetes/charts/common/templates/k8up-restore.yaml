{{- if .Values.k8up.restore.enabled }}
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  name: {{ .Values.name }}-onsite-restore
  namespace: {{ .Values.name }}
  annotations:
    argocd.argoproj.io/sync-wave: "2"
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  entrypoint: main
  templates:
    - name: main
      steps:
        - - name: full-k8up-restore
            templateRef:
              name: manage-k8up
              template: full-k8up-restore
              clusterScope: true
            arguments:
              parameters:
                - name: target-namespace
                  value: {{ .Values.name }}
                - name: location
                  value: onsite
                - name: k8up-endpoint
                  value: http://seaweedfs-s3.seaweedfs.svc.cluster.local:8333
                - name: k8up-bucket
                  value: k8up-backups
                - name: k8up-secret
                  value: k8up
                - name: fsGroup
                  value: {{ .Values.k8up.restore.config.fsGroup }}
{{- end }}