{{- if .Values.velero.backup.enabled }}
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: {{ .Values.name }}-backup-schedule
  namespace: velero
  annotations:
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true,Delete=false,Prune=false
    argocd.argoproj.io/sync-wave: "20"
    argocd.argoproj.io/compare-options: IgnoreExtraneous
spec:
  schedule: "{{ .Values.velero.backup.schedule | default "0 1 * * *" }}"
  template:
    ttl: "{{ .Values.velero.backup.ttl | default "720h0m0s" }}"
    includedNamespaces:
      - {{ .Values.name }}
    includedResources:
      - persistentvolumeclaims
      - persistentvolumes
    snapshotMoveData: false
{{- end }}
